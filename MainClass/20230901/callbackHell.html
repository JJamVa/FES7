<!DOCTYPE html>
<html lang="ko-KR">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
</head>

<body>
    <script>
        "use strict";
        class UserStorage {
            // ì‚¬ìš©ìžê°€ ìž…ë ¥í•œ ê°’ê³¼ ìœ ì € ì •ë³´ê°€ ì¼ì¹˜í•˜ëŠ” ìœ ì €ë¥¼ ì°¾ëŠ”ë‹¤.
            searchUser(userName, password, onSuccess, onError) {
                // ì„±ê³µí•˜ë©´ onSuccess ì½œë°±í•¨ìˆ˜ë¥¼ ë¶€ë¦„. ì‹¤íŒ¨í•˜ë©´ onError.'
                const requestObj = new XMLHttpRequest();
                requestObj.open("GET", "users.json"); // ìš”ì²­ ì´ˆê¸°í™”
                requestObj.onreadystatechange = () => {
                    if (requestObj.readyState === 4 && requestObj.status === 200) {
                        const result = JSON.parse(requestObj.responseText).user.find((item) => {
                            // JSON.parse : jsonì„ parseí•´ì„œ ê°ì²´ë¡œ ë§Œë“¤ì–´ì¤Œ.
                            // stringify : ê°ì²´ë¥¼ jsonìœ¼ë¡œ
                            return item.userName === userName && item.password === password;
                            // itemì˜ ìœ ì €ë„¤ìž„ê³¼ passwordê°€ ìž…ë ¥ë°›ì€ ìœ ì €ë„¤ìž„ê³¼ passwordê°€ ê°™ì€ì§€ í™•ì¸í•¨.
                        });
                        if (result) {
                            // ì¼ì¹˜í•˜ëŠ” ìœ ì €ê°€ ì¡´ìž¬í•˜ë©´,
                            onSuccess(userName);
                            //userNameì„ ì „ë‹¬í•´ì„œ ì¸ì‚¬ë§ì— ë§žëŠ” ì´ë¦„ì„ ì°¾ì•„ì•¼ë¨.
                        } else {
                            onError(new Error("user not found")); // ì‚¬ìš©ìž ì •ì˜ ì—ëŸ¬ ìƒì„±ìž : ì—ëŸ¬ ë©”ì„¸ì§€ë¥¼ ì‚¬ìš©ìž ë§ˆìŒëŒ€ë¡œ ë§Œë“¤ ìˆ˜ ìžˆë‹¤.
                        }
                    }
                };
                requestObj.send(); // ìš”ì²­ ë³´ë‚´ê¸°
            }

            // ìœ ì €ì— ë§žëŠ” ì¸ì‚¬ë§ì„ ì¶œë ¥í•©ë‹ˆë‹¤.
            sayHi(user, onSuccess, onError) {
                const requestObj = new XMLHttpRequest();
                requestObj.open("GET", "greetings.json"); // ìš”ì²­ ì´ˆê¸°í™”
                requestObj.onreadystatechange = () => {
                    if (requestObj.readyState === 4 && requestObj.status === 200) {
                        const result = JSON.parse(requestObj.responseText).greetings.find(
                            (item) => {
                                // console.log(user);
                                //return item.userName === user.userName; //?????????????????
                                // if(item.user === user) return items.greetings
                                return item.userName === user;
                            }
                        );
                        if (result) {
                            onSuccess(result);
                        } else {
                            onError(new Error("no greetings"));
                        }
                    }
                };
                requestObj.send();
            }
        }


        const userStorage = new UserStorage();

        const userName = prompt("ì´ë¦„ì„ ìž…ë ¥í•˜ì„¸ìš”.");
        const userPassword = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ìž…ë ¥í•˜ì„¸ìš”.");

        userStorage.searchUser(
            userName,
            userPassword,
            (name) => {
                userStorage.sayHi(
                    name,
                    (result) => {
                        alert(
                            `ë‹¹ì‹ ì—ê²Œ ì¸ì‚¬í•©ë‹ˆë‹¤! ${result.userName}ë‹˜ ${result.greetings}`
                        );
                    },
                    (error) => {
                        console.log(error);
                    }
                );
            },
            (error) => {
                console.log(error);
            }
        );  // ì½œë°± ì§€ì˜¥....ðŸ˜ˆ
    </script>
</body>

</html>